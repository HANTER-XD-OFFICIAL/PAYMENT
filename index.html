<!-- index.html -->
<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Payment Demo — Sonali Bank Transfer</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; background:#f6f6f6; }
    .card { max-width:420px; margin: auto; background:white; border:1px solid #eee; padding:16px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.03); }
    .icons { display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap;}
    .paybtn { width:100%; padding:12px; border:none; background:#4CAF50; color:white; font-size:16px; border-radius:6px; cursor:pointer; }
    input, select, button { width:100%; padding:10px; margin:8px 0; box-sizing:border-box; }
    .bankcard { border:1px dashed #ccc; padding:12px; border-radius:6px; margin:10px 0; }
    .small { font-size:13px; color:#666; }
  </style>
</head>
<body>
  <div class="card">
    <h3>Recharge — Demo</h3>
    <div class="icons">
      <div style="padding:6px 10px;border:1px solid #ddd;border-radius:6px;">Rocket</div>
      <div style="padding:6px 10px;border:1px solid #ddd;border-radius:6px;">bKash</div>
      <div style="padding:6px 10px;border:1px solid #ddd;border-radius:6px;">Card</div>
      <div style="padding:6px 10px;border:2px solid #4CAF50;border-radius:6px;background:#f0fff4;">Sonali Bank</div>
    </div>

    <label>Amount (BDT)</label>
    <input id="amount" type="number" value="10" />

    <label>Payment method</label>
    <select id="method">
      <option value="card">Card</option>
      <option value="mobile_wallet">Mobile Wallet</option>
      <option value="bank_transfer" selected>Bank Transfer (Sonali)</option>
      <option value="netbanking">Net Banking</option>
    </select>

    <div id="bankDetails" class="bankcard">
      <strong>Sonali Bank</strong>
      <p class="small">Account number: <span id="accNum">0701301000064</span> <button onclick="copyText('#accNum')">Copy</button></p>
      <p class="small">Account name: <span id="accName">MD RASEL</span></p>
      <p class="small">Branch: <span id="branch">AKKALPUR</span></p>
      <p class="small">Mobile wallet (for contact): <strong id="wallet">01882278234</strong> <button onclick="copyText('#wallet')">Copy</button></p>
      <p class="small">Important: When transferring, put reference shown after you click CREATE BANK TRANSFER.</p>
    </div>

    <button id="pay" class="paybtn">CREATE BANK TRANSFER</button>
    <p id="msg"></p>

    <hr>
    <h4>Check status</h4>
    <input id="checkId" placeholder="Enter payment id" />
    <button onclick="checkStatus()">Check</button>
    <pre id="statusBox"></pre>
  </div>

<script>
  function copyText(selector){
    const text = document.querySelector(selector).innerText;
    navigator.clipboard.writeText(text).then(()=> alert('Copied: ' + text));
  }

  document.getElementById('pay').addEventListener('click', async ()=>{
    const amount = document.getElementById('amount').value;
    const res = await fetch('/create-bank-transfer', {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ amount })
    });
    const data = await res.json();
    if (data.payment_id) {
      document.getElementById('msg').innerText = `Payment created. Reference: ${data.payRef}. Payment ID: ${data.payment_id}. Upload screenshot at /upload-screenshot/${data.payment_id}`;
    } else {
      document.getElementById('msg').innerText = 'Error: ' + (data.error||'unknown');
    }
  });

  async function checkStatus(){
    const id = document.getElementById('checkId').value;
    if(!id) return alert('Enter payment id');
    const res = await fetch('/status/' + id);
    const j = await res.json();
    document.getElementById('statusBox').innerText = JSON.stringify(j, null, 2);
  }
</script>
</body>
</html>